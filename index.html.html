<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-E5JC6BQJ17"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-E5JC6BQJ17');
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>PayCalc - Honor√°rios & Conversor de Moedas</title>
    
    <!-- PWA Settings -->
    <meta name="theme-color" content="#0a304b" />
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <meta name="description" content="Calculadora de honor√°rios, hora t√©cnica e convers√£o de moedas (D√≥lar, Euro, Real) em tempo real para freelancers." />
    <meta name="keywords" content="calculadora honor√°rios, conversor moeda, dolar hoje, valor hora t√©cnica, freelancer, timer financeiro" />
  
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              app: {
                bg: '#0a304b',
                card: 'rgba(255, 255, 255, 0.06)',
                input: 'rgba(255, 255, 255, 0.08)',
                green: '#1DB954',
                greenLight: '#00cc66',
                blue: '#0c6ef1',
                orange: '#ff751f',
                red: '#ff3131',
              },
            },
            fontFamily: {
              inter: ['Inter', 'sans-serif'],
            },
            animation: {
              'fade-in': 'fadeIn 0.3s ease-in-out',
            },
            keyframes: {
              fadeIn: {
                '0%': { opacity: '0', transform: 'translateY(10px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              }
            }
          },
        },
      };
    </script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    
    <style>
      body {
        font-family: 'Inter', sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      .history-scroll::-webkit-scrollbar {
        width: 6px;
      }
      .history-scroll::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 3px;
      }
      .history-scroll::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 3px;
      }
    </style>

    <!-- React & Babel Standalone (Para rodar sem build) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.1",
    "react-dom/": "https://esm.sh/react-dom@^19.2.1/",
    "react/": "https://esm.sh/react@^19.2.1/"
  }
}
</script>
</head>
<body class="bg-[#0a304b] text-white min-h-screen flex flex-col items-center">
    
    <div id="root" class="w-full flex justify-center"></div>

    <script type="text/babel">
        // --- 1. UTILS (format.ts) ---
        const formatCurrency = (value) => {
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };

        const formatTimeParts = (ms) => {
            const h = Math.floor(ms / 3600000);
            const m = Math.floor((ms % 3600000) / 60000);
            const s = Math.floor((ms % 60000) / 1000);
            const milliseconds = Math.floor((ms % 1000) / 10);

            return {
                formattedTime: `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`,
                formattedMs: `,${String(milliseconds).padStart(2, '0')}`
            };
        };

        const generateReport = (timeStr, grossStr, netStr, rate, tax) => {
            return `üìä RELAT√ìRIO DE HONOR√ÅRIOS

‚è± Tempo trabalhado: ${timeStr}
üí∞ Valor bruto: ${grossStr}
üí∏ Valor l√≠quido: ${netStr}
üíº Valor/hora: R$ ${rate.toFixed(2)}
üìâ Impostos: ${tax}%

Gerado em ${new Date().toLocaleString('pt-BR')}`;
        };

        // --- 2. HOOKS (useStopwatch.ts) ---
        const { useState, useEffect, useRef, useCallback } = React;

        const STORAGE_KEY = 'paycalc_state_v3';
        const HISTORY_KEY = 'paycalc_history_v3';
        const BEEP_AUDIO = "data:audio/wav;base64,UklGRl9vT1BXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU"; 

        const useStopwatch = () => {
            const [elapsedTime, setElapsedTime] = useState(0);
            const [isRunning, setIsRunning] = useState(false);
            const [hourlyRate, setHourlyRate] = useState(150);
            const [taxRate, setTaxRate] = useState(20);
            const [history, setHistory] = useState([]);

            const startTimeRef = useRef(null);
            const requestRef = useRef(null);
            const lastHourRef = useRef(-1);
            const audioRef = useRef(null);

            useEffect(() => {
                audioRef.current = new Audio(BEEP_AUDIO);
            }, []);

            useEffect(() => {
                const savedStateStr = localStorage.getItem(STORAGE_KEY);
                const savedHistoryStr = localStorage.getItem(HISTORY_KEY);

                if (savedHistoryStr) {
                    try { setHistory(JSON.parse(savedHistoryStr)); } catch (e) { console.error(e); }
                }

                if (savedStateStr) {
                    try {
                        const savedState = JSON.parse(savedStateStr);
                        setHourlyRate(savedState.hourlyRate ?? 150);
                        setTaxRate(savedState.taxRate ?? 20);
                        if (savedState.isRunning) {
                            setElapsedTime(savedState.elapsedTime || 0);
                            setIsRunning(false);
                        } else {
                            setElapsedTime(savedState.elapsedTime || 0);
                            setIsRunning(false);
                        }
                    } catch (e) { console.error(e); }
                }
            }, []);

            useEffect(() => {
                const stateToSave = { elapsedTime, isRunning, hourlyRate, taxRate };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(stateToSave));
            }, [elapsedTime, isRunning, hourlyRate, taxRate]);

            useEffect(() => {
                localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
            }, [history]);

            const animate = useCallback(() => {
                if (startTimeRef.current !== null) {
                    setElapsedTime((prevTotal) => {
                        const currentNow = Date.now();
                        const diff = currentNow - (startTimeRef.current || currentNow);
                        startTimeRef.current = currentNow;
                        
                        const newTotal = prevTotal + diff;
                        const h = Math.floor(newTotal / 3600000);
                        if (h > lastHourRef.current && h > 0) {
                            lastHourRef.current = h;
                            audioRef.current?.play().catch(() => {});
                        }
                        return newTotal;
                    });
                    requestRef.current = requestAnimationFrame(animate);
                }
            }, []);

            useEffect(() => {
                if (isRunning) {
                    startTimeRef.current = Date.now();
                    requestRef.current = requestAnimationFrame(animate);
                } else {
                    if (requestRef.current) cancelAnimationFrame(requestRef.current);
                    startTimeRef.current = null;
                }
                return () => {
                    if (requestRef.current) cancelAnimationFrame(requestRef.current);
                };
            }, [isRunning, animate]);

            const toggleTimer = () => setIsRunning(!isRunning);

            const resetTimer = () => {
                if (elapsedTime > 5000) addToHistory();
                setIsRunning(false);
                setElapsedTime(0);
                lastHourRef.current = -1;
            };

            const addToHistory = () => {
                const gross = (elapsedTime / 3600000) * hourlyRate;
                const net = taxRate > 0 ? gross * (1 - taxRate / 100) : gross;
                const { formattedTime, formattedMs } = formatTimeParts(elapsedTime);
                const timeStr = formattedTime + formattedMs;

                const newItem = {
                    id: Date.now().toString(),
                    date: new Date().toLocaleString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' }),
                    duration: timeStr,
                    gross: gross.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }),
                    net: net.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })
                };

                setHistory(prev => [newItem, ...prev].slice(0, 50));
            };

            return { elapsedTime, isRunning, hourlyRate, setHourlyRate, taxRate, setTaxRate, history, toggleTimer, resetTimer };
        };

        // --- 2.1 NEW HOOK (useCurrency.ts logic integrated for standalone) ---
        const API_URL = 'https://api.exchangerate-api.com/v4/latest/';

        const useCurrency = () => {
          const [amount, setAmount] = useState(100);
          const [from, setFrom] = useState('USD');
          const [to, setTo] = useState('BRL');
          const [rate, setRate] = useState(0);
          const [loading, setLoading] = useState(false);
          const [error, setError] = useState(null);

          const fetchRate = useCallback(async () => {
            setLoading(true);
            setError(null);
            try {
              const response = await fetch(`${API_URL}${from}`);
              if (!response.ok) throw new Error('Falha ao buscar cota√ß√£o');
              const data = await response.json();
              const newRate = data.rates[to];
              setRate(newRate);
            } catch (err) {
              console.error(err);
              setError('Erro de conex√£o');
              if (from === 'USD' && to === 'BRL') setRate(5.0);
            } finally {
              setLoading(false);
            }
          }, [from, to]);

          useEffect(() => {
            fetchRate();
            const interval = setInterval(fetchRate, 60000); 
            return () => clearInterval(interval);
          }, [fetchRate]);

          const convertedValue = amount * rate;

          const swapCurrencies = () => {
            setFrom(to);
            setTo(from);
          };

          return { amount, setAmount, from, setFrom, to, setTo, rate, convertedValue, loading, error, swapCurrencies, fetchRate };
        };


        // --- 3. APP COMPONENT (App.tsx) ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('timer');
            const currencies = ['USD', 'BRL', 'EUR', 'GBP', 'CAD', 'AUD', 'JPY', 'CNY', 'ARS'];

            const {
                elapsedTime,
                isRunning,
                hourlyRate,
                setHourlyRate,
                taxRate,
                setTaxRate,
                history,
                toggleTimer,
                resetTimer
            } = useStopwatch();

            const {
              amount,
              setAmount,
              from,
              setFrom,
              to,
              setTo,
              rate,
              convertedValue,
              loading,
              swapCurrencies
            } = useCurrency();

            const [copyFeedback, setCopyFeedback] = useState('üìã Copiar Relat√≥rio');
            const gross = (elapsedTime / 3600000) * hourlyRate;
            const net = taxRate > 0 ? gross * (1 - taxRate / 100) : gross;
            const { formattedTime, formattedMs } = formatTimeParts(elapsedTime);

            const handleCopy = () => {
                const fullTimeStr = formattedTime + formattedMs;
                const grossStr = formatCurrency(gross);
                const netStr = formatCurrency(net);
                const report = generateReport(fullTimeStr, grossStr, netStr, hourlyRate, taxRate);

                navigator.clipboard.writeText(report).then(() => {
                    setCopyFeedback('‚úÖ Copiado!');
                    setTimeout(() => setCopyFeedback('üìã Copiar Relat√≥rio'), 2000);
                });
            };

            return (
                <div className="w-full flex flex-col items-center py-12 px-4 gap-16">
                    <main className="w-full max-w-[420px] bg-white/5 backdrop-blur-xl border border-white/10 rounded-3xl p-6 sm:p-8 text-center shadow-2xl flex flex-col relative overflow-hidden transition-all duration-300">
                        
                        {/* TABS */}
                        <div className="flex bg-black/20 p-1 rounded-xl mb-6">
                          <button onClick={() => setActiveTab('timer')} className={`flex-1 py-2 text-sm font-bold rounded-lg transition-all ${activeTab === 'timer' ? 'bg-app-card shadow text-white' : 'text-white/50 hover:text-white/80'}`}>‚è±Ô∏è Timer & Honor√°rios</button>
                          <button onClick={() => setActiveTab('converter')} className={`flex-1 py-2 text-sm font-bold rounded-lg transition-all ${activeTab === 'converter' ? 'bg-app-card shadow text-white' : 'text-white/50 hover:text-white/80'}`}>üí± Conversor Moeda</button>
                        </div>

                        {activeTab === 'timer' && (
                          <div className="flex flex-col gap-6 animate-fade-in">
                            <div>
                                <h1 className="text-[22px] font-extrabold mb-1 text-white tracking-tight">Calculadora de Honor√°rios</h1>
                                <p className="text-[13px] text-[#bbbbbb]">Acompanhe suas horas e ganhos.</p>
                            </div>

                            <div>
                                <div className="text-xs font-semibold text-[#cccccc] mb-1 uppercase tracking-wide">Tempo Decorrido</div>
                                <div className="font-extrabold text-[#ffffff] tracking-tighter tabular-nums text-5xl sm:text-[54px] leading-tight my-1">
                                    {formattedTime}<span className="text-3xl sm:text-[36px] opacity-70">{formattedMs}</span>
                                </div>
                            </div>

                            <div className="space-y-5">
                                <div>
                                    <div className="text-xs font-semibold text-[#cccccc] mb-1 uppercase tracking-wide">Valor Bruto</div>
                                    <div className="text-4xl sm:text-[38px] font-extrabold text-app-green tracking-tight">{formatCurrency(gross)}</div>
                                </div>
                                <div>
                                    <div className="text-xs font-semibold text-[#cccccc] mb-1 uppercase tracking-wide">Valor L√≠quido</div>
                                    <div className="text-3xl sm:text-[30px] font-extrabold text-app-greenLight tracking-tight">{formatCurrency(net)}</div>
                                </div>
                            </div>

                            <div className="space-y-4 text-left">
                                <div>
                                    <label className="block text-[13px] font-semibold text-[#cccccc] mb-2 pl-1">Valor por Hora (R$)</label>
                                    <input type="number" value={hourlyRate} onChange={(e) => setHourlyRate(Math.max(0, parseFloat(e.target.value) || 0))} className="w-full p-[14px] text-[18px] text-center bg-app-input border-2 border-[#2a5d84] rounded-xl text-white focus:outline-none focus:border-app-blue transition-colors appearance-none" />
                                </div>
                                <div>
                                    <label className="block text-[13px] font-semibold text-[#cccccc] mb-2 pl-1">Impostos (%)</label>
                                    <input type="number" value={taxRate} onChange={(e) => setTaxRate(Math.max(0, Math.min(100, parseFloat(e.target.value) || 0)))} className="w-full p-[14px] text-[18px] text-center bg-app-input border-2 border-[#2a5d84] rounded-xl text-white focus:outline-none focus:border-app-blue transition-colors appearance-none" />
                                </div>
                            </div>

                            <div className="flex gap-3 mt-1">
                                <button onClick={toggleTimer} className={`flex-1 p-4 text-[17px] font-bold rounded-xl transition-all active:translate-y-1 shadow-lg ${isRunning ? 'bg-app-orange text-white' : 'bg-app-blue text-white'}`}>{isRunning ? 'Pausar' : 'Iniciar'}</button>
                                <button onClick={resetTimer} className="flex-1 p-4 text-[17px] font-bold rounded-xl transition-all active:translate-y-1 shadow-lg bg-app-red text-white">Resetar</button>
                            </div>

                            <button onClick={handleCopy} className="w-full p-3 text-[15px] font-bold rounded-xl transition-all active:translate-y-1 shadow-lg bg-app-greenLight text-white mt-1 flex items-center justify-center gap-2 hover:brightness-110">{copyFeedback}</button>

                            {history.length > 0 && (
                                <div className="mt-2 text-left bg-black/20 rounded-xl p-4 max-h-[180px] overflow-y-auto history-scroll border border-white/5">
                                    <div className="text-[10px] font-bold text-white/40 uppercase mb-2 tracking-wider">Hist√≥rico Recente</div>
                                    <div className="space-y-0">
                                        {history.map((item) => (
                                            <div key={item.id} className="py-2 border-b border-white/10 last:border-0 text-[13px] opacity-90 text-white/90 flex justify-between">
                                                <div><span className="font-semibold text-app-blue">{item.date.split(' ')[0]}</span> <span className="opacity-50">{item.duration}</span></div>
                                                <span className="text-app-greenLight font-mono">{item.gross}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                          </div>
                        )}

                        {activeTab === 'converter' && (
                           <div className="flex flex-col gap-6 animate-fade-in min-h-[400px] justify-center">
                             <div>
                               <h1 className="text-[22px] font-extrabold mb-1 text-white tracking-tight">Convers√£o Global</h1>
                               <p className="text-[13px] text-[#bbbbbb]">Cota√ß√µes em tempo real.</p>
                             </div>

                             <div className="bg-white/5 rounded-2xl p-6 border border-white/10">
                               <div className="text-xs font-semibold text-[#cccccc] mb-1 uppercase tracking-wide text-left">Valor Convertido</div>
                               <div className="text-5xl font-extrabold text-app-greenLight tracking-tight text-left break-words">
                                  {loading ? <span className="animate-pulse opacity-50">---</span> : convertedValue.toLocaleString('pt-BR', { style: 'currency', currency: to })}
                               </div>
                               <div className="text-left mt-2 text-sm text-white/50">1 {from} = {rate.toFixed(4)} {to}</div>
                             </div>

                             <div className="flex flex-col gap-4">
                               <div>
                                 <label className="block text-[13px] font-semibold text-[#cccccc] mb-2 pl-1 text-left">Valor a Converter</label>
                                 <input type="number" value={amount} onChange={(e) => setAmount(Math.max(0, parseFloat(e.target.value) || 0))} className="w-full p-[18px] text-[24px] font-bold text-left bg-app-input border-2 border-[#2a5d84] rounded-xl text-white focus:outline-none focus:border-app-blue transition-colors appearance-none" />
                               </div>

                               <div className="flex items-center gap-2">
                                 <div className="flex-1">
                                   <label className="block text-[11px] font-bold text-[#cccccc] mb-1 text-left uppercase">De</label>
                                   <select value={from} onChange={(e) => setFrom(e.target.value)} className="w-full p-3 bg-app-card border border-white/10 rounded-xl text-white font-bold focus:border-app-blue outline-none">
                                      {currencies.map(c => <option key={c} value={c}>{c}</option>)}
                                   </select>
                                 </div>

                                 <button onClick={swapCurrencies} className="mt-5 p-3 rounded-full bg-white/10 hover:bg-white/20 transition-colors active:scale-90" title="Inverter Moedas">‚áÑ</button>

                                 <div className="flex-1">
                                   <label className="block text-[11px] font-bold text-[#cccccc] mb-1 text-left uppercase">Para</label>
                                   <select value={to} onChange={(e) => setTo(e.target.value)} className="w-full p-3 bg-app-card border border-white/10 rounded-xl text-white font-bold focus:border-app-blue outline-none">
                                      {currencies.map(c => <option key={c} value={c}>{c}</option>)}
                                   </select>
                                 </div>
                               </div>
                             </div>
                             <div className="mt-4 p-4 bg-blue-500/10 border border-blue-500/20 rounded-xl text-xs text-blue-200 text-left leading-relaxed">
                               ‚ÑπÔ∏è As taxas s√£o atualizadas automaticamente a cada minuto baseadas no mercado internacional.
                             </div>
                           </div>
                        )}

                    </main>

                    <article className="w-full max-w-2xl text-[#d1d5db] space-y-10 pb-12 leading-relaxed">
                        <header className="border-b border-white/10 pb-8">
                            <h2 className="text-3xl font-bold text-white mb-4">PayCalc: Finan√ßas para Profissionais</h2>
                            <p className="text-lg text-[#9ca3af]">Agora com <strong>Conversor de Moedas</strong> integrado. Seja calculando sua hora t√©cnica ou convertendo pagamentos internacionais, o PayCalc √© a ferramenta definitiva para o n√¥made digital moderno.</p>
                        </header>

                        {activeTab === 'converter' && (
                          <section className="space-y-4 animate-fade-in">
                             <h3 className="text-2xl font-semibold text-white">Recebendo em D√≥lar ou Euro?</h3>
                             <p>Para freelancers brasileiros que trabalham para o exterior, a varia√ß√£o cambial pode significar lucro ou preju√≠zo. Use o nosso conversor para:</p>
                             <ul className="list-disc pl-6 space-y-2 text-[#e5e7eb]">
                               <li>Estimar o valor real das suas faturas antes de emitir a Invoice.</li>
                               <li>Calcular quanto vale sua hora de trabalho em moedas fortes.</li>
                               <li>Planejar compras de equipamentos importados.</li>
                             </ul>
                          </section>
                        )}

                        {activeTab === 'timer' && (
                          <section className="space-y-4 animate-fade-in">
                            <h3 className="text-2xl font-semibold text-white">Domine sua Hora T√©cnica</h3>
                            <p>O erro n√∫mero um do freelancer √© n√£o contabilizar o tempo. Use o cron√¥metro acima para medir exatamente quanto tempo cada tarefa leva e descubra se o projeto realmente valeu a pena.</p>
                          </section>
                        )}
                    </article>

                    <footer className="w-full text-center border-t border-white/10 pt-8 pb-4 text-white/60 text-sm">
                        <p className="mb-2">PayCalc ¬© {new Date().getFullYear()} - Todos os direitos reservados.</p>
                        <p>Desenvolvido por <a href="https://wa.me/5511988484500" target="_blank" rel="noopener noreferrer" className="text-[#ff9900] no-underline font-extrabold hover:text-[#ffad33] transition-colors">Trafer Digital</a></p>
                    </footer>
                </div>
            );
        };

        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(<App />);

        // --- REGISTER SERVICE WORKER ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>